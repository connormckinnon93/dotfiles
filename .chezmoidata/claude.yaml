# Claude Code configuration
# Managed by chezmoi - edit this file, then run `chezmoi apply`

# Pinned versions for Claude-related dependencies
versions:
  context7_mcp: "2.1.0"  # Last reviewed: 2026-01-28

# Claude Code plugin marketplaces
# Add new marketplaces here - they'll be registered in known_marketplaces.json
# and cloned via .chezmoiexternal.toml.tmpl
# Add plugins under each marketplace to enable them in settings.json
marketplaces:
  claude-plugins-official:
    source: "github"
    repo: "anthropics/claude-plugins-official"
    plugins:
      # Language servers
      - "typescript-lsp"
      - "pyright-lsp"
      - "gopls-lsp"
      # Git & GitHub workflows
      - "commit-commands"      # /commit, /commit-push-pr, /clean_gone
      - "pr-review-toolkit"    # 6 PR review agents
      - "code-review"          # /code-review with confidence scoring
  superpowers-marketplace:
    source: "github"
    repo: "obra/superpowers-marketplace"
    plugins:
      - "superpowers"
      - "elements-of-style"
  thedotmack:
    source: "github"
    repo: "thedotmack/claude-mem"
    plugins:
      - "claude-mem"
  # Workspace-only marketplaces - cloned but NOT globally enabled
  # workspacePlugins enabled at project scope via ~/Workspace/.claude/settings.json
  anthropic-knowledge-work:
    source: "github"
    repo: "anthropics/knowledge-work-plugins"
    workspacePlugins:
      - productivity           # Tasks, calendars, daily workflows
  anthropic-agent-skills:
    source: "github"
    repo: "anthropics/skills"
    workspacePlugins:
      - docx                   # Word documents
      - pdf                    # PDF manipulation
      - pptx                   # PowerPoint presentations
      - xlsx                   # Excel spreadsheets

# Permissions follow a trust gradient:
# - allow: Routine development operations - safe, reversible, low-impact
# - ask: Operations crossing trust boundaries - network, system, packages
# - deny: Irreversible destructive actions - blocked entirely
permissions:
  defaultMode: "acceptEdits"

  allow:
    # Built-in tools
    - "WebFetch"
    - "WebSearch"
    - "Read"
    - "Edit"
    - "Write"
    - "Glob"
    - "Grep"
    - "Search"
    - "Update"

    # Skills (global)
    - "Skill(superpowers:*)"
    - "Skill(claude-mem:*)"
    - "Skill(elements-of-style:*)"
    - "Skill(brainstorming)"
    # Note: anthropic-knowledge-work and anthropic-agent-skills permissions
    # are defined in ~/Workspace/.claude/settings.json (workspace-scoped)

    # MCP tools
    - "mcp__context7__resolve-library-id"
    - "mcp__context7__query-docs"
    - "mcp__plugin_claude-mem_mcp-search__search"
    - "mcp__plugin_claude-mem_mcp-search__timeline"
    - "mcp__plugin_claude-mem_mcp-search__get_observations"

    # Read operations
    - "Bash(cat *)"
    - "Bash(head *)"
    - "Bash(tail *)"
    - "Bash(ls *)"
    - "Bash(find *)"
    - "Bash(grep *)"
    - "Bash(rg *)"
    - "Bash(tree *)"
    - "Bash(wc *)"
    - "Bash(file *)"
    - "Bash(which *)"
    - "Bash(type *)"

    # Data processing (read-only)
    - "Bash(jq *)"
    - "Bash(yq *)"

    # Subagent types
    - "Task(superpowers:code-reviewer)"

    # Git - local operations (safe, reversible)
    - "Bash(git status*)"
    - "Bash(git log*)"
    - "Bash(git diff*)"
    - "Bash(git show*)"
    - "Bash(git branch)"          # List branches only
    - "Bash(git branch -a*)"      # List all branches
    - "Bash(git branch -v*)"      # List with verbose info
    - "Bash(git branch --list*)"  # List with pattern
    - "Bash(git add *)"
    - "Bash(git commit *)"
    - "Bash(git checkout *)"
    - "Bash(git switch *)"
    - "Bash(git stash*)"
    - "Bash(git fetch*)"
    - "Bash(git worktree list*)"  # List worktrees (read-only)

    # GitHub CLI - read operations (low risk, used by PR review skills)
    - "Bash(gh pr view*)"
    - "Bash(gh pr list*)"
    - "Bash(gh pr diff*)"
    - "Bash(gh pr checks*)"
    - "Bash(gh pr status*)"
    - "Bash(gh issue view*)"
    - "Bash(gh issue list*)"
    - "Bash(gh issue status*)"
    - "Bash(gh repo view*)"

    # Testing - all languages
    - "Bash(npm test*)"
    - "Bash(npm run test*)"
    - "Bash(npm run lint*)"
    - "Bash(npm run format*)"
    - "Bash(pnpm test*)"
    - "Bash(pnpm run test*)"
    - "Bash(pnpm run lint*)"
    - "Bash(yarn test*)"
    - "Bash(yarn lint*)"
    - "Bash(pytest*)"
    - "Bash(python -m pytest*)"
    - "Bash(go test*)"
    - "Bash(cargo test*)"
    - "Bash(bundle exec rspec*)"
    - "Bash(bundle exec rake test*)"
    - "Bash(rspec *)"
    - "Bash(rake test*)"
    - "Bash(make test*)"
    - "Bash(vitest*)"
    - "Bash(jest *)"

    # Linting & formatting
    - "Bash(eslint *)"
    - "Bash(prettier *)"
    - "Bash(black *)"
    - "Bash(ruff *)"
    - "Bash(mypy *)"
    - "Bash(python -m black*)"
    - "Bash(python -m ruff*)"
    - "Bash(python -m mypy*)"
    - "Bash(bundle exec rubocop*)"

    # Build commands
    - "Bash(npm run build*)"
    - "Bash(pnpm run build*)"
    - "Bash(yarn build*)"
    - "Bash(go build*)"
    - "Bash(cargo build*)"
    - "Bash(make)"
    - "Bash(make build*)"
    - "Bash(tsc*)"

    # Misc commands
    - "Bash(mkdir *)"

  ask:
    # Git - remote/history operations
    - "Bash(git push*)"
    - "Bash(git pull*)"
    - "Bash(git merge *)"
    - "Bash(git rebase *)"

    # Git - local but potentially destructive
    - "Bash(git branch -d *)"      # Delete merged branch
    - "Bash(git branch -D *)"      # Force delete branch
    - "Bash(git branch -m *)"      # Rename branch
    - "Bash(git branch --delete*)" # Delete branch (long form)
    - "Bash(git worktree add *)"   # Create worktree
    - "Bash(git worktree remove*)" # Remove worktree
    - "Bash(git worktree prune*)"  # Clean up worktree metadata

    # GitHub CLI - API and write operations
    - "Bash(gh api *)"            # API calls (read or write)
    - "Bash(gh pr create*)"
    - "Bash(gh pr merge*)"
    - "Bash(gh pr close*)"
    - "Bash(gh pr comment*)"
    - "Bash(gh pr review*)"
    - "Bash(gh pr edit*)"
    - "Bash(gh issue create*)"
    - "Bash(gh issue close*)"
    - "Bash(gh issue comment*)"
    - "Bash(gh issue edit*)"
    - "Bash(gh repo create*)"
    - "Bash(gh repo fork*)"
    - "Bash(gh release create*)"

    # Network operations
    - "Bash(curl *)"
    - "Bash(wget *)"
    - "Bash(npm publish*)"
    - "Bash(docker push*)"

    # Package installation - JS
    - "Bash(npm install*)"
    - "Bash(npm ci*)"
    - "Bash(pnpm install*)"
    - "Bash(pnpm add*)"
    - "Bash(yarn install*)"
    - "Bash(yarn add*)"

    # Package installation - Python
    - "Bash(pip install*)"
    - "Bash(pip3 install*)"
    - "Bash(pipx install*)"
    - "Bash(poetry install*)"
    - "Bash(poetry add*)"
    - "Bash(uv pip install*)"
    - "Bash(uv add*)"

    # Package installation - Ruby
    - "Bash(bundle install*)"
    - "Bash(bundle update*)"
    - "Bash(gem install*)"

    # Package installation - Go/Rust
    - "Bash(cargo install*)"
    - "Bash(go install*)"
    - "Bash(go get*)"

    # System modifications
    - "Bash(brew *)"
    - "Bash(sudo *)"
    - "Bash(chmod *)"
    - "Bash(chown *)"
    - "Bash(launchctl *)"
    - "Bash(defaults *)"

    # Container operations
    - "Bash(docker build*)"
    - "Bash(docker run*)"
    - "Bash(docker compose*)"

  deny:
    # Destructive file operations
    - "Bash(rm -rf *)"
    - "Bash(rm -fr *)"
    - "Bash(rmdir *)"

    # Git - history destruction
    - "Bash(git reset --hard*)"
    - "Bash(git clean -f*)"
    - "Bash(git push --force*)"
    - "Bash(git push -f *)"
    - "Bash(git checkout -- .)"
    - "Bash(git restore .)"

    # Dangerous system commands
    - "Bash(killall *)"
    - "Bash(pkill *)"
    - "Bash(shutdown*)"
    - "Bash(reboot*)"

# Workspace-specific permissions (~/Workspace/.claude/settings.json)
# These are ADDITIONAL to global permissions, applied only in the workspace
# Skill permissions for workspacePlugins are auto-generated from packages.yaml
workspace_permissions:
  allow:
    # Preview generated documents (scoped to workspace)
    - "Bash(open ~/Workspace/*)"

  ask: []

  deny: []

# Workspace MCP connectors (~/Workspace/.mcp.json)
# HTTP-based MCP servers for productivity plugin integrations
# Disabled by default - uncomment 'enabled' list to activate connectors
workspace_mcp:
  servers:
    slack: "https://mcp.slack.com/mcp"
    notion: "https://mcp.notion.com/mcp"
    asana: "https://mcp.asana.com/v2/mcp"
    linear: "https://mcp.linear.app/mcp"
    atlassian: "https://mcp.atlassian.com/v1/mcp"
    ms365: "https://microsoft365.mcp.claude.com/mcp"
    monday: "https://mcp.monday.com/mcp"
    clickup: "https://mcp.clickup.com/mcp"
  # enabled:
  #   - slack      # Team messaging
  #   - notion     # Knowledge base
  #   - linear     # Project tracking
  #   - ms365      # Email, calendar, docs
